language: go
go_import_path: github.com/newrelic/go-agent

matrix:
  include:
  - go: "1.7"
    env: DIRS=v3/newrelic,v3/internal,v3/examples
  - go: "1.8"
    env: DIRS=v3/newrelic,v3/internal,v3/examples
  - go: "1.9"
    env: DIRS=v3/newrelic,v3/internal,v3/examples
  - go: "1.10"
    env: DIRS=v3/newrelic,v3/internal,v3/examples
  - go: "1.11"
    env: DIRS=v3/newrelic,v3/internal,v3/examples
  - go: "1.12"
    env: DIRS=v3/newrelic,v3/internal,v3/examples
  - go: "1.13"
    env: DIRS=v3/newrelic,v3/internal,v3/examples,v3/integrations/logcontext
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrawssdk/v1
      - EXTRATESTING="go get -u github.com/aws/aws-sdk-go@master"
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrawssdk/v2
      - EXTRATESTING="go get -u github.com/aws/aws-sdk-go-v2@master"
  - go: "1.13"
    env: DIRS=v3/integrations/nrecho
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrgin/v1
      - EXTRATESTING="go get -u github.com/gin-gonic/gin@master"
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrgorilla/v1
      - EXTRATESTING="go get -u github.com/gorilla/mux@master"
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrlogrus
      - EXTRATESTING="go get -u github.com/sirupsen/logrus@master"
  - go: "1.13"
    env: DIRS=v3/integrations/nrlogxi/v1
  - go: "1.13"
    env: DIRS=v3/integrations/nrpkgerrors
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrlambda
      - EXTRATESTING="go get -u github.com/aws/aws-lambda-go@master"
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrmysql
      - EXTRATESTING="go get -u github.com/go-sql-driver/mysql@master"
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrpq
      - EXTRATESTING="go get -u github.com/lib/pq@master"
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrpq/example/sqlx
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrsqlite3
      - EXTRATESTING="go get -u github.com/mattn/go-sqlite3@master"
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrgrpc
      # As of Nov 2019, go get -u google.golang.org/grpc@master
      # doesn't work.  So instead let's test against the latest
      # released version.
      - EXTRATESTING="go get -u"
  # As of October 2019, errors result from go get -u github.com/micro/go-micro
  # - go: "1.13"
  #   env: DIRS=v3/integrations/nrmicro
  - go: "1.13"
    env: DIRS=v3/integrations/nrnats
  - go: "1.13"
    env: DIRS=v3/integrations/nrstan
  - go: "1.13"
    env: DIRS=v3/integrations/logcontext
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrzap
      - EXTRATESTING="go get -u go.uber.org/zap@master"
  - go: "1.13"
    env:
      - DIRS=v3/integrations/nrhttprouter
      - EXTRATESTING="go get -u github.com/julienschmidt/httprouter@master"
  - go: "1.13"
    env: DIRS=v3/integrations/nrb3
  - go: "1.13"
    env: DIRS=v3/integrations/nrmongo

# Skip the install step. Don't `go get` dependencies.
install: true

script:
  - bash build-script.sh
